<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:mo="https://gitee.com/aun/alan">
<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
    <title>成绩单</title>
    <style>
        .students, .course{
            border: 1px solid #7D32A7;
            width: 190px;
            height: 36px;
            border-radius: 2px;
            text-align: left;
            color: -internal-light-dark(black, white);
            line-height: 36px;
            padding-left: 10px;
            transition: all .3s;
            transition-property: all;
            transition-duration: 0.3s;
            transition-timing-function: ease;
            transition-delay: 0s;
            -webkit-transition: all .3s;
        }
        .students:hover, .course:hover{
            border: 1px solid #7D32A7;
            cursor: pointer;
        }
    </style>
    <style media="print" type="text/css">
        .noprint{visibility:hidden}
    </style>
</head>
<body class="alan-layout-page">
<div class="layui-card">
    <div class="layui-card-header alan-card-header">
        <span><i class="fa fa-bars"></i> 学生成绩</span>
        <i class="layui-icon layui-icon-refresh refresh-btn noprint"></i>
    </div>
    <div class="layui-card-body">
        <div class="layui-row alan-card-screen noprint">
            <div class="pull-left layui-form-pane alan-search-box">
                <form class="layui-form" action="#" lay-filter="searchForm">
                    <div class="layui-inline">
                        <label class="layui-form-label">学年</label>
                        <div class="layui-input-block">
                            <input class="layui-input" type="text" name="academicYear" id="academicYear" placeholder="请选择" autocomplete="off" readonly>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">学期</label>
                        <div class="layui-input-block">
                            <select name="semester" id="semester" lay-filter="semester">
                                <option></option>
                                <option value="1" th:selected="${param.semester==1}">上学期</option>
                                <option value="2" th:selected="${param.semester==2}">下学期</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <a class="layui-btn alan-search">
                            <i class="fa fa-search"></i>
                        </a>
                    </div>
                    <div class="layui-inline">
                        <a class="layui-btn alan-print">
                            <i class="fa fa-print"></i>
                        </a>
                    </div>
                </form>
            </div>
        </div>
        <div class="alan-table-wrap" id="print">
            <table class="layui-table alan-table">
                <thead>
                <tr>
                    <th>课程</th>
                    <th>分数</th>
                    <th>成绩说明</th>
                </tr>
                </thead>
                <tbody id="tbody">
                <tr>
                    <td colspan=3>
                        <p style="text-align:center;">未查询到数据</p>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script th:replace="/common/template :: script"></script>
<script type="text/javascript">
    layui.use(['form', 'upload', 'laydate'], function () {
        var $ = layui.jquery;
        var form = layui.form;
        var upload = layui.upload;
        var laydate = layui.laydate;
        var formFilter = "searchForm";
        // 学年
        laydate.render({
            elem: '#academicYear' //指定元素
            ,type: 'year'
            ,trigger: 'click' //采用click弹出
            ,format: 'yyyy年'
            ,max: 0
        });
        // 获取参数
        var getParam = function(){
            return form.val(formFilter)
        }
        // 渲染
        var renderScore = function(data){
            var _html = "";
            if(data && data.length>0){
                for(var i in data){
                    _html += "<tr><td>《"+data[i].courseId.names+"》</td><td>"+data[i].fraction+"</td><td>"+data[i].description+"</td></tr>";
                }
            } else {
                _html = "<tr><td colspan=3><p style='text-align:center;'>未查询到数据</p></td></tr>";
            }
            $("#tbody").html(_html);
        }
        // 查询
        $(".alan-search").click(function(){
            var formData = getParam();
            if(!formData.academicYear){
                layer.msg('请选择<span style="color:red;">学年</span>', {icon: 2});
                return;
            }
            if(!formData.semester){
                layer.msg('请选择<span style="color:red;">学期</span>', {icon: 2});
                return;
            }
            $.post("/system/student/GetMyScore", formData, function(result){
                if(result.code==200 && result.data && result.data.length>0){
                    layer.msg(result.msg, {icon: 1});
                } else {
                    layer.msg("未查询到数据", {icon: 2});
                }
                // 渲染
                renderScore(result.data);
            })
        });
        // 打印
        $(".alan-print").click(function(){
            window.print();
        });
    })
</script>
</body>
</html>